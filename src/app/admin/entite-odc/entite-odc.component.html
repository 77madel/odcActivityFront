<div class="p-12 bg-slate-100">
  <!-- Titre -->
  <div class="flex flex-wrap items-center gap-6 text-2xl font-bold tracking-normal text-white max-md:max-w-full">
    <div class="flex flex-col grow items-start mt-15 bg-orange-400 rounded-3xl w-fit max-md:max-w-full">
      <div class="z-10 px-5 pb-0 bg-black rounded-3xl w-[734px] max-md:px-5">
        Nos Entités
      </div>
    </div>
    <div class="mt-3 flex-grow flex justify-end"> <!-- Utilisation de flex-grow pour l'alignement -->
      <button mat-flat-button class="bg-orange-400 hover:bg-orange-500 text-white font-bold py-2 px-4 rounded" (click)="toggleForm()">
        {{ isEditMode ? 'Modifier' : 'Ajouter' }}
      </button>
    </div>
  </div>

  <!-- Année -->
  <div *ngIf="isTableVisible" class="text-2xl font-bold tracking-normal text-black max-md:ml-1">
    <span class="text-orange-400">Années en cours</span> : {{ currentYear }}
  </div>

  <div *ngIf="isTableVisible" class="flex flex-col rounded-none">
    <div class="flex flex-col items-start py-24 pr-8 pl-20 w-full bg-slate-100 max-md:px-5 max-md:pb-24 max-md:max-w-full">

      <!-- Section d'images -->
      <div class="self-end mt-40 mb-0 w-full max-w-[1051px] max-md:mt-10 max-md:mb-2.5 max-md:max-w-full">
        <div class="grid grid-cols-4 gap-5 max-md:grid-cols-1">

          <div *ngFor="let element of entiteList" (click)="viewEntiteDetails(element)" class="flex flex-col font-bold tracking-normal">

            <!-- Bloc FabLab Solidaire -->
            <div class="fgrid grid-cols-4">
              <img [src]="element.logo" loading="lazy" class="object-contain w-full aspect-[1.19]" alt="Entite" />
              <div class="px-8 py-2.5 mt-8 text-1xl text-orange-400 bg-black rounded-3xl max-md:px-5">
                {{ element.nom }}
              </div>
              <div class="self-start mt-2 text-base text-black">
                Activités : {{ element.id ? (activiteCount[element.id] || 'Chargement...') : 'ID non défini' }}
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>



  <!-- Formulaire d'ajout (affiché uniquement si isFormVisible est vrai) -->
  <div *ngIf="isFormVisible" class="mt-8">
    <mat-card class="w-full mx-auto">
      <mat-card-header class="mb-2">
        <mat-card-title>{{ isEditMode ? 'Modifier un élément' : 'Ajouter un élément' }}</mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <form (ngSubmit)="ajouterEntite()">
          <div class="flex gap-4">
            <mat-form-field class="w-1/2">
              <mat-label>Nom</mat-label>
              <input matInput name="nom" [(ngModel)]="entiteToAdd.nom" required>
            </mat-form-field>

            <mat-form-field class="w-1/2">
              <mat-label>Description</mat-label>
              <input matInput name="description" [(ngModel)]="entiteToAdd.description" required>
            </mat-form-field>
          </div>

            <div class="flex gap-4" class="mb-4">
              <label class="block text-gray-700 text-sm font-bold mb-2" for="file-input">
                Sélectionnez un fichier
              </label>
              <input
                id="file-input"
                type="file"
                (change)="onFileChange($event)"
                accept=".png, .jpeg"
                required
                class="block w-full text-sm text-gray-500
                   file:py-2 file:px-4
                   file:rounded-full file:border-0
                   file:text-sm file:font-semibold
                   file:bg-blue-50 file:text-blue-700
                   hover:file:bg-blue-100"
              />
              <div *ngIf="selectedFile" class="mt-2 text-gray-600">
                Fichier sélectionné : <span class="font-semibold">{{ selectedFile.name }}</span>
              </div>

              <mat-form-field class="w-full mt-2">
                <mat-label>Sélectionner le responsable (personnel) :</mat-label>
                <mat-select name="utilisateur" [(ngModel)]="selectedUtilisateur" required>
                  <mat-option *ngFor="let option of utilisateur" [value]="option">
                    {{ option.nom }} {{ option.prenom }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

          <div class="w-full">
            <button mat-raised-button color="primary" type="submit">
              {{ isEditMode ? 'Modifier' : 'Ajouter' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>
  </div>
</div>
